@model TopTrump.Models.SelectStatViewModel

<h1>Select a Stat</h1>

<p>Cards:</p>
<table class="table">
    <thead>
        <tr>
            <th>Card Name</th>
            <th>@Model.StatNames[0]</th>
            <th>@Model.StatNames[1]</th>
            <th>@Model.StatNames[2]</th>
            <th>@Model.StatNames[3]</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var card in Model.Cards)
        {
            <tr>
                <td>@card.CardName</td>
                <td>@card.Stat1</td>
                <td>@card.Stat2</td>
                <td>@card.Stat3</td>
                <td>@card.Stat4</td>
                <td>

                        <input type="hidden" name="SelectedCardId" value="@card.CardId" />
                        <button type="submit" class="btn btn-primary select-card-btn" disabled>Select Card</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Add a dropdown list to select a stat -->
<form asp-action="PlayRound" method="submitPlayRoundForm(); return false;">
    <div class="form-group">
        <label for="selectedStat">Select a Stat:</label>
        <select id="selectedStat" name="SelectedStat" class="form-control">
            <option value="">-- Select a Stat --</option>
            <option value="@Model.StatNames[0]">@Model.StatNames[0]</option>
            <option value="@Model.StatNames[1]">@Model.StatNames[1]</option>
            <option value="@Model.StatNames[2]">@Model.StatNames[2]</option>
            <option value="@Model.StatNames[3]">@Model.StatNames[3]</option>
        </select>
    </div>
</form>

<div id="roundResultsContainer"></div>

@section scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        document.querySelectorAll('.select-card-btn').forEach(function (button) {
            button.addEventListener("click", function () {
                var selectStat = document.getElementById("selectedStat");
                if (selectStat.value !== "") {
                    return true;
                } else {
                    alert("Please select a stat.");
                    return false;
                }
            });
        });

        document.getElementById("selectedStat").addEventListener("change", function () {
            var selectCardButtons = document.querySelectorAll('.select-card-btn');
            selectCardButtons.forEach(function (button) {
                button.disabled = (this.value === "");
            }, this);
        });
    </script>

    <script>
        $(document).ready(function () {
            $('.select-card-btn').click(function () {
                var selectedCardId = $(this).data('card-id');
                var selectedStat = $('#selectedStat').val();

                if (selectedStat !== "") {
                    $.ajax({
                        url: '@Url.Action("PlayRound", "Game")',
                        type: 'POST',
                        data: { SelectedCardId: selectedCardId, SelectedStat: selectedStat },
                        success: function (data) {
                            $('#roundResultsContainer').append(data);
                        }
                    });
                } else {
                    alert("Please select a stat.");
                }
            });
        });
    </script>


}


